# ğŸš€ Linuxè¿ç»´æ‰‹å†Œ

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

```bash

# ä¿®æ”¹hostname
sudo hostnamectl set-hostname ã€hostnameã€‘

# æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬
uname -a
cat /etc/redhat-release # åŸºäºRed Hatçš„ç³»ç»Ÿ
cat /etc/os-release

################## ç³»ç»Ÿç›‘æ§ç›¸å…³ ##################
lscpu  # æŸ¥çœ‹cpuä¿¡æ¯

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨ç‡
free -h
# æŸ¥çœ‹ CPU å†…å­˜ç­‰ ä½¿ç”¨ç‡
top 
htop # top çš„å¢å¼ºç‰ˆï¼ˆéœ€å®‰è£…ï¼‰

lsblk # # æŸ¥çœ‹ç£ç›˜æŒ‚è½½å‘½ä»¤-æ ‘å½¢å±•ç¤º

# ç»Ÿè®¡æ¨¡å¼æ˜¾ç¤ºè™šæ‹Ÿå†…å­˜ã€è¿›ç¨‹ã€CPU æ´»åŠ¨çš„è¯¦ç»†ä¿¡æ¯æ±‡æ€»
vmstat -s

################## è¿›ç¨‹ç›¸å…³ ##################
# é€šè¿‡æ–‡ä»¶åæˆ–è€…æœåŠ¡åæŸ¥çœ‹ä½¿ç”¨æƒ…å†µ
ps aux | grep ã€è¿›ç¨‹å æ–‡ä»¶åæˆ–æœåŠ¡åã€‘ 
# æŸ¥çœ‹æŒ‡å®š PID çš„åŠ¨æ€èµ„æºå ç”¨
top -p PID  
cat /proc/PID/status          # æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†çŠ¶æ€
lsof -p PID                   # æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶
strace -p PID                 # è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆæ’æŸ¥å¡é¡¿ï¼‰

# å¼ºåˆ¶å…³é—­è¿›ç¨‹
kill -9 PID

# æŸ¥çœ‹è¿›ç¨‹çš„å·¥ä½œç›®å½•
ls -l /proc/ã€PIDã€‘/cwd

# æŸ¥çœ‹è¿›ç¨‹ å¯åŠ¨å‘½ä»¤
ps -p ã€PIDã€‘ -o args=

# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ
ps aux --sort=-%cpu,-%mem

# ä½¿ç”¨ glances æŸ¥çœ‹ç»¼åˆç³»ç»ŸçŠ¶æ€ -- éœ€å®‰è£…
glances

################## æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ ##################
netstat -tulnp | grep :ç«¯å£å·
ss -tulnp | grep :ç«¯å£å·  # æ¨èä½¿ç”¨ï¼Œæ•ˆç‡æ›´é«˜
lsof -i:ç«¯å£å·            # æŸ¥çœ‹å…·ä½“å“ªä¸ªç¨‹åºå ç”¨ç«¯å£
ps -ef | grep ç«¯å£å·

################## æŸ¥çœ‹æ–‡ä»¶å¤¹å ç”¨å­˜å‚¨æƒ…å†µ ##################
df -h # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ç‡
du -sh *   # å½“å‰ç›®å½•ä¸‹æ¯ä¸ªæ–‡ä»¶å¤¹å ç”¨ç©ºé—´
du -sh */ | sort -rh # æŸ¥çœ‹å½“å‰ç›®å½•å­ç›®å½•ä»å¤§åˆ°å°æ’åº
du -sh ./* | sort -rh | head -n 20 # æŸ¥çœ‹å½“å‰ç›®å½•å­˜å‚¨å ç”¨ç©ºé—´æœ€å¤§çš„å‰20ä½

```

---

## ğŸ› ï¸ ç”¨æˆ·ç›¸å…³å‘½ä»¤

```bash
# æ–°å¢ç”¨æˆ·
adduser {ç”¨æˆ·å}

## å°†ç”¨æˆ·æ·»åŠ åˆ°æŒ‡å®šç»„
sudo usermod -aG {ç»„å} {ç”¨æˆ·å}

# å°†æ–°ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„
sudo usermod -aG sudo {ç”¨æˆ·å}  # Ubuntu / Debian ç³»ç»Ÿ
sudo usermod -aG wheel {ç”¨æˆ·å} # CentOS / RHEL / Fedora / SUSE ç³»ç»Ÿ

# å°†æ–°ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker {ç”¨æˆ·å}

# éªŒè¯ç”¨æˆ·åˆ›å»ºå’Œç»„æˆå‘˜èº«ä»½
id {ç”¨æˆ·å}

# åˆ‡æ¢åˆ°æ–°ç”¨æˆ·
su {ç”¨æˆ·å}

# ä¿®æ”¹å¯†ç 
sudo su #1. åˆ‡æ¢åˆ° root ç”¨æˆ·
passwd publisher # 2. è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç 
# è¾“å…¥æ–°å¯†ç 
# å†æ¬¡è¾“å…¥æ–°å¯†ç 
exit

# åˆ é™¤ç”¨æˆ·
sudo userdel ç”¨æˆ·å
# åˆ é™¤è¯¥ç”¨æˆ·çš„å®¶ç›®å½•å’Œé‚®ä»¶ç›®å½•
sudo userdel -r ç”¨æˆ·å

```

## ğŸ› ï¸ vimå‘½ä»¤

### å¸¸ç”¨æ“ä½œ

```bash
:q! # å¼ºåˆ¶é€€å‡º
:wq # ä¿å­˜å¹¶é€€å‡º

i # æ’å…¥æ¨¡å¼

###### åˆ é™¤ ######
dd # åˆ é™¤å½“å‰è¡Œ
:%d # æ¸…ç©ºå…¨éƒ¨å†…å®¹

 ##### æŸ¥è¯¢ #####
/æœç´¢è¯ # å‘ä¸‹æœç´¢
?æœç´¢è¯ # å‘ä¸Šæœç´¢
n / N   # è·³è½¬åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªåŒ¹é…
# é‡å¤ä¸Šä¸€æ¬¡æŸ¥æ‰¾	
//
# å…³é—­æŸ¥æ‰¾é«˜å…‰æ˜¾ç¤º
:nohl

##### æ›¿æ¢ #####
:%s/old/new/g # å…¨å±€æ›¿æ¢ï¼ˆåŠ  `c` ç¡®è®¤æ¯æ¬¡æ›¿æ¢ï¼‰
:10,20s/old/new/g # æ›¿æ¢10-20è¡Œå†…å®¹

```

### ç§»åŠ¨å‘½ä»¤

| å‘½ä»¤     | åŠŸèƒ½             |
|--------|----------------|
| 0 / $  | 	è¡Œé¦–/è¡Œå°¾         |
| gg / G | 	æ–‡ä»¶å¼€å¤´/ç»“å°¾       |
| :n     | 	è·³è½¬åˆ°ç¬¬nè¡Œï¼ˆå¦‚ :10ï¼‰ |
| w / b  | è·³åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªå•è¯å¼€å¤´  |

### ç¼–è¾‘æ“ä½œ

| å‘½ä»¤         | åŠŸèƒ½            |
|------------|---------------|
| i / a      | 	åœ¨å…‰æ ‡å‰/åæ’å…¥     |
| o / O      | 		åœ¨å½“å‰è¡Œä¸‹/ä¸Šæ’å…¥æ–°è¡Œ |
| x          | 		x           |
| dd         | 			åˆ é™¤æ•´è¡Œ       |
| yy / p     | 			å¤åˆ¶è¡Œ / ç²˜è´´   |
| u / Ctrl+r | 				æ’¤é”€ / é‡åš   |
| >> / <<    | 				å¢åŠ /å‡å°‘ç¼©è¿›   |

### æŸ¥æ‰¾æ›¿æ¢

```bash
/pattern     # å‘ä¸‹æœç´¢
?pattern     # å‘ä¸Šæœç´¢
n / N        # è·³è½¬åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªåŒ¹é…
:%s/old/new/g # å…¨å±€æ›¿æ¢ï¼ˆåŠ  `c` ç¡®è®¤æ¯æ¬¡æ›¿æ¢ï¼‰
:10,20s/old/new/g # æ›¿æ¢10-20è¡Œå†…å®¹
```

## ğŸ› ï¸ æœåŠ¡ç›¸å…³

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl list-unit-files --type=service
systemctl list-unit-files --type=service | grep ã€æœåŠ¡åã€‘

# æŸ¥çœ‹é«˜å†…å­˜/CPUæ¶ˆè€—çš„è¿›ç¨‹
ps aux --sort=-%mem | head -n 15 # æŸ¥çœ‹top 15 
ps aux --sort=-%cpu | head -n 15

```

## ğŸ› ï¸ ç³»ç»Ÿæ—¶åŒºç›¸å…³

```bash
# è®¾ç½®ç³»ç»Ÿæ—¶åŒº
sudo timedatectl set-timezone 'Asia/Shanghai'

# æŸ¥çœ‹å½“å‰æ—¶åŒº
timedatectl

# æŸ¥çœ‹å½“å‰æ—¶é—´
date
```

## æŸ¥æ‰¾å‘½ä»¤

```bash

######### å¸¸ç”¨ ##############

# æŒ‰åç§°æŸ¥æ‰¾ï¼ˆå½“å‰ç›®å½•é€’å½’ï¼‰ -type f è¡¨ç¤ºåªæœç´¢æ–‡ä»¶ï¼Œ-type d è¡¨ç¤ºæŒ‰åç§°æœç´¢
find . -type f -name ã€æ–‡ä»¶åã€‘ # -type f è¡¨ç¤ºåªæœç´¢æ–‡ä»¶
find . -type d -name ã€æ–‡ä»¶å¤¹åç§°ã€‘ # -type d è¡¨ç¤ºåªæœç´¢æ–‡ä»¶å¤¹

# æ ¹æ®æ–‡ä»¶å†…å®¹æŸ¥è¯¢æ–‡ä»¶ä½ç½®
find . -type f -name "*.sh" | xargs grep "ã€æ–‡ä»¶å†…å®¹ã€‘" 

############## æ ¹æ®æœåŠ¡åç§°è¿›è¡ŒæŸ¥è¯¢ ##############

# æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
which ã€æœåŠ¡åã€‘ # ç¤ºä¾‹ï¼šwhich python3

# æŸ¥æ‰¾äºŒè¿›åˆ¶/æºç /æ‰‹å†Œè·¯å¾„
whereis java

########### é«˜çº§ç”¨æ³• ##############

# æŒ‰æ—¶é—´æŸ¥æ‰¾ï¼ˆ7å¤©å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼‰
find /var/log -type f -mtime -7
# æŸ¥æ‰¾ç©ºç›®å½•
find /path -type d -empty

# æŸ¥æ‰¾/var/logä¸‹å¤§äº1GBçš„æ—¥å¿—
find /var/log -type f -size +1G -exec ls -lh {} \;
# æ¸…ç©ºæ–‡ä»¶å†…å®¹ï¼ˆä¿ç•™æ–‡ä»¶å¥æŸ„ï¼‰
: > /path/to/large.log

```

## æ›¿æ¢å‘½ä»¤

```bash
########## ä¸å¸¦æ­£åˆ™ ##########
find [è·¯å¾„] -type f -name "*.sh" -exec sed -i 's|ã€éœ€è¦è¢«æ›¿æ¢çš„æ–‡æœ¬ã€‘|ã€æ›¿æ¢ä¸ºçš„æ–‡æœ¬ã€‘|g' {} +
# ç¤ºä¾‹ ï¼ˆå½“å‰ç›®å½•é€’å½’ï¼‰å°† lingyunnuo -> yunnuo
find . -type f -name "*.sh" -exec sed -i 's|lingyunnuo|yunnuo|g' {} +

########## å¸¦æ­£åˆ™ ##########
find [è·¯å¾„] -type f -name "*.sh" -exec sed -i 's/åŸå†…å®¹/æ–°å†…å®¹/g' {} \;
# æ›¿æ¢ IP åœ°å€ï¼Œå°† 192.168.1.x æ›¿æ¢ä¸º 10.0.0.x
find . -name "*.sh" -exec sed -i -E 's/192\.168\.1\.([0-9]+)/10.0.0.\1/g' {} \;
# åˆ é™¤ç©ºè¡Œ
find /scripts -name "*.sh" -exec sed -i '/^$/d' {} \; 

```

## å‹ç¼©å·¥å…·

### tar å‘½ä»¤

#### å¸¸ç”¨æ“ä½œ

```bash

# åŸºç¡€è¯­æ³•
tar [é€‰é¡¹] [è¾“å‡ºå‹ç¼©æ–‡ä»¶] [è¾“å…¥æ–‡ä»¶/ç›®å½•]

################ è§£å‹ #######################
# è§£å‹åˆ°å½“å‰ç›®å½•
tar -xf ã€å‹ç¼©åŒ….tarã€‘
tar -zxf ã€å‹ç¼©åŒ….tar.gzã€‘
# è§£å‹åˆ°æŒ‡å®šç›®å½•
tar -xf ã€å‹ç¼©åŒ….tarã€‘ -C /home/data


################ å‹ç¼© #########################

tar -czvf archive.tar.gz /path/to/folder

#å°†file1.txtå’Œfile2.txtä¸¤ä¸ªæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªåä¸ºarchive.tarçš„å½’æ¡£æ–‡ä»¶ã€‚
tar -cvf archive.tar file1.txt file2.txt

#å°†file1.txtå’Œfile2.txtä¸¤ä¸ªæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªåä¸ºarchive.tar.gzçš„gzipå‹ç¼©å½’æ¡£æ–‡ä»¶ã€‚
tar -czvf archive.tar.gz file1.txt file2.txt

```

tarå‹ç¼©å‚æ•°è§£é‡Š

- -cï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å½’æ¡£æ–‡ä»¶ã€‚
- -zï¼šé€šè¿‡ gzip å‹ç¼©å½’æ¡£æ–‡ä»¶ã€‚
- -vï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç”¨äºæ˜¾ç¤ºå‹ç¼©è¿‡ç¨‹ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚
- -fï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶çš„åç§°

### zip å‘½ä»¤

```bash
# åŸºç¡€è¯­æ³•
zip [é€‰é¡¹] å‹ç¼©åŒ…å.zip æ–‡ä»¶/ç›®å½•
unzip [é€‰é¡¹] å‹ç¼©åŒ…å.zip

# å‹ç¼©
zip archive.zip file.txt
#å°† filename å‹ç¼©ä¸º filename.gzï¼Œå¹¶åˆ é™¤åŸæ–‡ä»¶ã€‚


# è§£å‹
gzip -d filename.gz

# è§£å‹å¹¶åˆ é™¤
gunzip filename.gz


# è§£å‹åˆ°å½“å‰ç›®å½•
unzip example.zip

# ä¸è¾“å‡ºè§£å‹æ—¥å¿—
unzip -q example.zip

# è§£å‹åˆ°æŒ‡å®šç›®å½•
unzip example.zip -d /data/example

```

## è½¯é“¾æ¥å’Œç¡¬é“¾æ¥è¿æ¥

- è½¯é“¾æ¥ï¼šç±»ä¼¼ Windows å¿«æ·æ–¹å¼ï¼ŒæŒ‡å‘æ–‡ä»¶è·¯å¾„ã€‚
- ç¡¬é“¾æ¥ï¼šæŒ‡å‘ç›¸åŒçš„ inodeï¼Œä¸ä¾èµ–æ–‡ä»¶åã€‚

åŒºåˆ«ï¼š

- åˆ é™¤åŸæ–‡ä»¶ï¼šè½¯é“¾æ¥å¤±æ•ˆï¼Œç¡¬é“¾æ¥ä»ç„¶å¯ç”¨ã€‚
- è·¨åˆ†åŒºï¼šè½¯é“¾æ¥å¯ä»¥ï¼Œç¡¬é“¾æ¥ä¸è¡Œã€‚
- ç›®å½•ï¼šé€šå¸¸ä¸å…è®¸åˆ›å»ºç¡¬é“¾æ¥ã€‚

```bash

ln -s source.txt softlink.txt     # åˆ›å»ºè½¯é“¾æ¥
ln source.txt hardlink.txt        # åˆ›å»ºç¡¬é“¾æ¥


## ç¤ºä¾‹ å°†/data/.jenkins-> /root/.jenkins
ln -s /data/.jenkins /root/.jenkins

```

## è®¾ç½®å®šæ—¶ä»»åŠ¡crontab

### å¸¸ç”¨å‘½ä»¤

```bash
# ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ crontab
crontab -e

# æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ crontab å†…å®¹
crontab -l

# æŸ¥çœ‹ç³»ç»Ÿ cron æ—¥å¿—
journalctl | grep CRON

# (æ…ç”¨) åˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ crontab
crontab -r

# åˆ é™¤å‰ç¡®è®¤
crontab -i

# æŸ¥çœ‹æŸç”¨æˆ·çš„ crontabï¼ˆéœ€ root æƒé™ï¼‰
crontab -u username -l

############ Crond æœåŠ¡ç®¡ç†å‘½ä»¤ï¼ˆæ ¹æ®ç³»ç»Ÿä¸åŒï¼‰ ############
# CentOS/RHEL
systemctl status crond
systemctl restart crond
systemctl enable crond

# Debian/Ubuntu
systemctl status cron
systemctl restart cron
systemctl enable cron

```

è¯­æ³•ç»“æ„ï¼š

```bash
* * * * * command_to_run
åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ è¦æ‰§è¡Œçš„å‘½ä»¤
```

ç¤ºä¾‹ï¼š

```
0 3 * * * /home/user/backup.sh :æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œå¤‡ä»½è„šæœ¬

*/1 * * * * /path/to/script.sh æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
```

### é«˜çº§ç”¨æ³•

#### ä½¿ç”¨ flock é˜²æ­¢å¹¶å‘æ‰§è¡Œï¼ˆé˜²é‡é”ï¼‰

```bash
*/1 * * * * flock -n /tmp/mytask.lock -c "/path/to/script.sh"
```

å‚æ•°è¯´æ˜ï¼š

- -nï¼šéé˜»å¡æ¨¡å¼ï¼Œå¦‚æœé”å­˜åœ¨åˆ™è·³è¿‡æœ¬æ¬¡æ‰§è¡Œã€‚
- /tmp/mytask.lockï¼šé”æ–‡ä»¶è·¯å¾„ã€‚

#### ä½¿ç”¨è„šæœ¬æ§åˆ¶æ›´å¤æ‚çš„é€»è¾‘ï¼ˆå¦‚åˆ¤æ–­æ—¶é—´ã€çŠ¶æ€ç­‰ï¼‰

##### 1. åˆ›å»ºä¸€ä¸ª shell è„šæœ¬(å®å¡”æ ‡å‡†æ¨¡æ¿)

```bash
#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
echo $$ > /www/server/cron/6087f11b092398b8fcd8b4f71ab29889.pl
cd /www/wwwroot/gxdproxy.gzbgyl.cn && php artisan schedule:run
echo "----------------------------------------------------------------------------"
endDate=`date +"%Y-%m-%d %H:%M:%S"`
echo "â˜…[$endDate] Successful"
echo "----------------------------------------------------------------------------"
if [[ "$1" != "start" ]]; then
    btpython /www/server/panel/script/log_task_analyzer.py /www/server/cron/6087f11b092398b8fcd8b4f71ab29889.log
fi
rm -f /www/server/cron/6087f11b092398b8fcd8b4f71ab29889.pl
```

##### 2. è®¾ç½®æ‰§è¡Œæƒé™

```bash
chmod +x /path/to/your_script.sh
```

##### 3. ç„¶ååœ¨ crontab ä¸­è°ƒç”¨å®ƒï¼š

```bash
# ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ crontab
crontab -e

########## æ·»åŠ æ‰§è¡Œä»»åŠ¡ ############
*/1 * * * * /path/to/your_script.sh
```

## scpæ–‡ä»¶æ‹·è´åˆ°å¦ä¸€å°æœåŠ¡å™¨

```bash
# ç¤ºä¾‹ scp -r /alidata/scripts root@192.168.0.77:/data/
scp -r /path/to/source user@ã€ipæˆ–åŸŸåã€‘:/path/to/destination

```

## æŸ¥çœ‹ I/O å‹åŠ›

```bash
iostat -x 1
iotop      # å®æ—¶æŸ¥çœ‹ I/O é‡çš„è¿›ç¨‹
```

## æ—¥å¿—æ£€æŸ¥

```bash
dmesg | tail       # å†…æ ¸é”™è¯¯ä¿¡æ¯
journalctl -xe     # æŸ¥çœ‹æœ€è¿‘ç³»ç»Ÿé”™è¯¯

############### æ—¥å¿—æ–‡ä»¶ #############
/var/log/messages      # ç³»ç»Ÿæ—¥å¿—ï¼ˆä¼ ç»Ÿ Linuxï¼‰
/var/log/syslog        # Debian ç³»
/var/log/dmesg         # å¯åŠ¨ç¡¬ä»¶æ—¥å¿—
```

## å¸¸ç”¨å·¥å…·å®‰è£…

### lrzszæ–‡ä»¶ä¸Šä¼ ä¸‹è½½å·¥å…·
```bash
# centosç³»ç»Ÿ
yum install -y lrzsz
# ubuntu
apt install lrzsz


# äºŒè¿›åˆ¶ä¸Šä¼ ï¼Œä¸å¼ºåˆ¶è¦†ç›–ï¼ˆé‡åˆ°åŒåæ–‡ä»¶ä¼šæç¤ºï¼‰
rz -b

# äºŒè¿›åˆ¶ä¸Šä¼ ï¼Œé‡åˆ°åŒåæ–‡ä»¶è‡ªåŠ¨é€€å‡ºé¿å…è¦†ç›–
rz -E   

# äºŒè¿›åˆ¶ä¸Šä¼  å¼ºåˆ¶è¦†ç›–
rz -bye

# ä¸‹è½½æ–‡ä»¶
sz /path/to/file
```

